---
import Layout from '@/layouts/Layout.astro'
import { fetchBlogPosts, fetchBlogPostBySlug } from '@/data/blogs'
import BlogInteractions from '@/components/react/BlogInteractions'
import CommentSection from '@/components/react/CommentSection'

export async function getStaticPaths() {
    const blogPosts = await fetchBlogPosts();

    return blogPosts
        .filter(post => post.is_published !== false && post.slug)
        .map(post => ({
            params: { slug: post.slug! },
            props: { post },
        }));
}

const { slug } = Astro.params;
const post = await fetchBlogPostBySlug(slug!);

if (!post) {
    return Astro.redirect('/blog');
}

const {
    title,
    subtitle,
    excerpt,
    author,
    published_date,
    tags,
    cover_image,
    content_html,
    views,
    likes,
    comments_count,
    read_time,
    category,
    allow_comments
} = post;

// Get related posts (same category, excluding current)
const allPosts = await fetchBlogPosts();
const relatedPosts = allPosts
    .filter(p => p.slug !== slug && p.category === category && p.is_published)
    .slice(0, 3);

// Get next/previous posts
const currentIndex = allPosts.findIndex(p => p.slug === slug);
const previousPost = currentIndex > 0 ? allPosts[currentIndex - 1] : null;
const nextPost = currentIndex < allPosts.length - 1 ? allPosts[currentIndex + 1] : null;
---

<Layout title={title}>
    <!-- Reading Progress Bar -->
    <div class="fixed top-0 left-0 w-full h-0.5 bg-transparent z-50">
        <div id="reading-progress" class="h-full bg-primary transition-all duration-150" style="width: 0%"></div>
    </div>

    <article class="min-h-screen bg-base-100">
        <!-- Breadcrumb Navigation -->
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 pt-4 pb-2">
            <div class="flex items-center gap-2 text-xs text-base-content/60">
                <a href="/" class="hover:text-primary transition-colors">Home</a>
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
                <a href="/blog" class="hover:text-primary transition-colors">Blog</a>
                {category && (
                    <>
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                        <span class="text-base-content">{category}</span>
                    </>
                )}
            </div>
        </nav>



        <!-- Main Content Container - Two Column Layout -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 pb-10">
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                
                <!-- Main Content Area (Left) -->
                <main class="lg:col-span-8 xl:col-span-8">
            
            <!-- Article Header -->
            <header class="pt-8 pb-8">
                {category && (
                    <a href={`/blog?category=${encodeURIComponent(category)}`} class="inline-block mb-4">
                        <span class="text-sm font-semibold text-primary uppercase tracking-wide hover:underline">
                            {category}
                        </span>
                    </a>
                )}
                <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-base-content mb-4 leading-tight tracking-tight">
                    {title}
                </h1>
                {subtitle && (
                    <p class="text-lg md:text-xl text-base-content/60 leading-relaxed mb-6">
                        {subtitle}
                    </p>
                )}
            </header>

            <!-- Author & Meta Info -->
            <div class="flex flex-wrap items-center gap-4 pb-6 mb-6 border-b border-base-300">
                <div class="flex items-center gap-3">
                    <div class="avatar placeholder">
                        <div class="bg-primary text-primary-content rounded-full w-10 h-10">
                            <span class="text-sm font-bold">{author?.charAt(0) || 'A'}</span>
                        </div>
                    </div>
                    <div class="flex flex-wrap items-center gap-2 text-sm">
                        <span class="font-medium text-base-content">{author || 'Anonymous'}</span>
                        {published_date && (
                            <>
                                <span class="text-base-content/40">•</span>
                                <time datetime={published_date} class="text-base-content/60">
                                    {new Intl.DateTimeFormat('en-US', {
                                        year: 'numeric',
                                        month: 'short',
                                        day: 'numeric',
                                    }).format(new Date(published_date))}
                                </time>
                            </>
                        )}
                        {read_time && (
                            <>
                                <span class="text-base-content/40">•</span>
                                <span class="text-base-content/60">{read_time} min read</span>
                            </>
                        )}
                    </div>
                </div>

                <div class="ml-auto">
                    <BlogInteractions
                        client:load
                        slug={slug!}
                        initialViews={views || 0}
                        initialLikes={likes || 0}
                    />
                </div>
            </div>

            <!-- Tags -->
            {tags && tags.length > 0 && (
                <div class="flex flex-wrap gap-2 mb-8">
                    {tags.map(tag => (
                        <a 
                            href={`/blog?tag=${encodeURIComponent(tag)}`}
                            class="text-xs px-3 py-1 bg-base-200 hover:bg-primary hover:text-primary-content rounded-full transition-colors"
                        >
                            #{tag}
                        </a>
                    ))}
                </div>
            )}

            <!-- Featured Image (if exists) -->
            {cover_image && (
                <figure class="mb-10 -mx-4 sm:-mx-6 md:mx-0">
                    <img
                        src={cover_image}
                        alt={title}
                        class="w-full rounded-none md:rounded-xl shadow-lg"
                    />
                </figure>
            )}

            <!-- Article Content -->
            <div class="prose prose-lg max-w-none mb-12
                prose-headings:font-bold prose-headings:text-base-content
                prose-h1:text-3xl prose-h1:mb-4 prose-h1:mt-8
                prose-h2:text-2xl prose-h2:mb-3 prose-h2:mt-8 prose-h2:pb-2 prose-h2:border-b prose-h2:border-base-300
                prose-h3:text-xl prose-h3:mb-3 prose-h3:mt-6
                prose-h4:text-lg prose-h4:mb-2 prose-h4:mt-5
                prose-p:text-base-content/80 prose-p:mb-5 prose-p:leading-relaxed
                prose-strong:text-base-content prose-strong:font-semibold
                prose-a:text-primary prose-a:no-underline hover:prose-a:underline
                prose-code:text-accent prose-code:bg-base-200 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-code:text-sm prose-code:before:content-[''] prose-code:after:content-['']
                prose-pre:bg-base-300 prose-pre:rounded-lg prose-pre:my-6 prose-pre:p-4
                prose-blockquote:border-l-4 prose-blockquote:border-primary prose-blockquote:bg-base-200/50 prose-blockquote:pl-4 prose-blockquote:py-2 prose-blockquote:my-6 prose-blockquote:not-italic
                prose-ul:my-4 prose-ul:space-y-1
                prose-ol:my-4 prose-ol:space-y-1
                prose-li:text-base-content/80
                prose-img:rounded-lg prose-img:my-6
                prose-hr:border-base-300 prose-hr:my-8
                prose-table:my-6
                prose-th:px-3 prose-th:py-2
                prose-td:px-3 prose-td:py-2
                "
            >
                {content_html && <div set:html={content_html} />}
            </div>

            <!-- Related Articles -->
            {relatedPosts.length > 0 && (
                <section class="mb-12 pt-8 border-t border-base-300">
                    <h2 class="text-2xl font-bold text-base-content mb-6">Related Articles</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {relatedPosts.map(relatedPost => (
                            <a
                                href={`/blog/${relatedPost.slug}`}
                                class="group block hover:bg-base-200 rounded-lg overflow-hidden transition-colors border border-base-300"
                            >
                                {relatedPost.cover_image && (
                                    <div class="overflow-hidden aspect-video bg-base-300">
                                        <img
                                            src={relatedPost.cover_image}
                                            alt={relatedPost.title}
                                            class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                                        />
                                    </div>
                                )}
                                <div class="p-4">
                                    {relatedPost.category && (
                                        <span class="text-xs text-primary font-medium mb-1 block">
                                            {relatedPost.category}
                                        </span>
                                    )}
                                    <h3 class="font-semibold text-base group-hover:text-primary transition-colors mb-1 line-clamp-2">
                                        {relatedPost.title}
                                    </h3>
                                    <div class="flex items-center gap-2 text-xs text-base-content/50 mt-2">
                                        {relatedPost.read_time && <span>{relatedPost.read_time} min</span>}
                                    </div>
                                </div>
                            </a>
                        ))}
                    </div>
                </section>
            )}

            <!-- Next/Previous Navigation -->
            {(previousPost || nextPost) && (
                <nav class="flex flex-col sm:flex-row justify-between gap-4 mb-10 pb-8 border-b border-base-300">
                    {previousPost ? (
                        <a
                            href={`/blog/${previousPost.slug}`}
                            class="flex-1 group p-4 hover:bg-base-200 rounded-lg transition-colors"
                        >
                            <div class="flex items-center gap-1 text-xs text-base-content/60 mb-1">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                </svg>
                                <span>Previous</span>
                            </div>
                            <h3 class="font-medium text-sm text-base-content group-hover:text-primary transition-colors line-clamp-2">
                                {previousPost.title}
                            </h3>
                        </a>
                    ) : <div class="flex-1"></div>}
                    
                    {nextPost ? (
                        <a
                            href={`/blog/${nextPost.slug}`}
                            class="flex-1 group p-4 hover:bg-base-200 rounded-lg transition-colors text-right"
                        >
                            <div class="flex items-center justify-end gap-1 text-xs text-base-content/60 mb-1">
                                <span>Next</span>
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </div>
                            <h3 class="font-medium text-sm text-base-content group-hover:text-primary transition-colors line-clamp-2">
                                {nextPost.title}
                            </h3>
                        </a>
                    ) : <div class="flex-1"></div>}
                </nav>
            )}

            <!-- Comments Section -->
            {allow_comments && (
                <section class="mb-10">
                    <CommentSection
                        client:load
                        slug={slug!}
                        allowComments={allow_comments}
                        initialCommentsCount={comments_count || 0}
                    />
                </section>
            )}
                
                </main>
                <!-- End Main Content -->
                
                <!-- Sticky Sidebar (Right) -->
                <aside class="hidden lg:block lg:col-span-4 xl:col-span-4">
                    <div class="sticky top-20 space-y-6">
                        
                        <!-- Table of Contents -->
                        <div class="card bg-base-200 border border-base-300 shadow-sm">
                            <div class="card-body p-5">
                                <h3 class="font-bold text-lg mb-3 flex items-center gap-2">
                                    <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"></path>
                                    </svg>
                                    Table of Contents
                                </h3>
                                <nav id="toc" class="text-sm space-y-2">
                                    <!-- TOC will be generated by JavaScript -->
                                </nav>
                            </div>
                        </div>

                        <!-- Author Card -->
                        <div class="card bg-base-200 border border-base-300 shadow-sm">
                            <div class="card-body p-5">
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="avatar placeholder">
                                        <div class="bg-primary text-primary-content rounded-full w-12 h-12">
                                            <span class="text-lg font-bold">{author?.charAt(0) || 'A'}</span>
                                        </div>
                                    </div>
                                    <div>
                                        <p class="font-bold text-base-content">{author || 'Anonymous'}</p>
                                        <p class="text-xs text-base-content/60">Author</p>
                                    </div>
                                </div>
                                <p class="text-sm text-base-content/70">
                                    Software engineer and technical writer sharing insights on web development, AI, and software engineering.
                                </p>
                            </div>
                        </div>

                        <!-- Share This Post -->
                        <div class="card bg-base-200 border border-base-300 shadow-sm">
                            <div class="card-body p-5">
                                <h3 class="font-bold text-base mb-3">Share this post</h3>
                                <div class="flex flex-col gap-2">
                                    <button
                                        id="share-twitter"
                                        class="btn btn-sm btn-outline gap-2 justify-start"
                                    >
                                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path>
                                        </svg>
                                        Share on Twitter
                                    </button>
                                    <button
                                        id="share-linkedin"
                                        class="btn btn-sm btn-outline gap-2 justify-start"
                                    >
                                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path>
                                        </svg>
                                        Share on LinkedIn
                                    </button>
                                    <button
                                        id="copy-link-btn"
                                        class="btn btn-sm btn-outline gap-2 justify-start"
                                    >
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                        </svg>
                                        Copy link
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Trending Posts -->
                        {allPosts.length > 0 && (
                            <div class="card bg-base-200 border border-base-300 shadow-sm">
                                <div class="card-body p-5">
                                    <h3 class="font-bold text-base mb-3 flex items-center gap-2">
                                        <svg class="w-5 h-5 text-primary" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                        </svg>
                                        Trending Posts
                                    </h3>
                                    <div class="space-y-4">
                                        {allPosts
                                            .filter(p => p.slug !== slug && p.is_published)
                                            .sort((a, b) => (b.views || 0) - (a.views || 0))
                                            .slice(0, 5)
                                            .map((post, index) => (
                                            <a
                                                href={`/blog/${post.slug}`}
                                                class="block group"
                                            >
                                                <div class="flex gap-3">
                                                    <span class="flex-shrink-0 w-6 h-6 rounded-full bg-primary/20 text-primary font-bold text-xs flex items-center justify-center">
                                                        {index + 1}
                                                    </span>
                                                    <div class="flex-1 min-w-0">
                                                        <h4 class="text-sm font-medium group-hover:text-primary transition-colors line-clamp-2">
                                                            {post.title}
                                                        </h4>
                                                        <p class="text-xs text-base-content/60 mt-1">
                                                            {post.views || 0} views
                                                        </p>
                                                    </div>
                                                </div>
                                            </a>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        <!-- Newsletter Signup -->
                        <div class="card bg-gradient-to-br from-primary/10 to-accent/10 border border-base-300 shadow-sm">
                            <div class="card-body p-5">
                                <h3 class="font-bold text-base mb-2">Subscribe to Newsletter</h3>
                                <p class="text-sm text-base-content/70 mb-4">
                                    Get updates on new articles weekly.
                                </p>
                                <form id="newsletter-form-sidebar" class="space-y-2">
                                    <input
                                        type="email"
                                        id="newsletter-email-sidebar"
                                        placeholder="your@email.com"
                                        class="input input-sm input-bordered w-full bg-base-100"
                                        required
                                    />
                                    <button type="submit" class="btn btn-sm btn-primary w-full" id="newsletter-btn-sidebar">
                                        Subscribe
                                    </button>
                                    <div id="newsletter-message-sidebar" class="text-xs mt-2 hidden"></div>
                                </form>
                            </div>
                        </div>

                    </div>
                </aside>
                <!-- End Sidebar -->
                
            </div>
        </div>

        <!-- Newsletter CTA Section -->
        <section class="bg-base-200 border-y border-base-300">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 py-10">
                <div class="max-w-2xl mx-auto text-center">
                    <h2 class="text-2xl font-bold text-base-content mb-3">
                        Never Miss an Update
                    </h2>
                    <p class="text-base text-base-content/70 mb-6">
                        Subscribe to get the latest articles delivered to your inbox weekly.
                    </p>
                    <form id="newsletter-form" class="flex flex-col sm:flex-row gap-2 max-w-md mx-auto">
                        <input
                            type="email"
                            id="newsletter-email"
                            placeholder="your@email.com"
                            class="input input-bordered flex-1 bg-base-100"
                            required
                        />
                        <button type="submit" class="btn btn-primary" id="newsletter-btn">
                            Subscribe
                        </button>
                    </form>
                    <div id="newsletter-message" class="text-sm mt-3 hidden"></div>
                </div>
            </div>
        </section>

        <!-- Back to Blog -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 py-8">
            <a href="/blog" class="inline-flex items-center gap-2 text-sm text-base-content/60 hover:text-primary transition-colors">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                </svg>
                <span>Back to all articles</span>
            </a>
        </div>
    </article>

    <!-- Reading Progress Script -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Reading Progress
            const progressBar = document.getElementById('reading-progress');
            
            const updateProgress = () => {
                const scrollTop = window.scrollY;
                const docHeight = document.documentElement.scrollHeight - window.innerHeight;
                const scrollPercent = (scrollTop / docHeight) * 100;
                
                if (progressBar) {
                    progressBar.style.width = `${Math.min(scrollPercent, 100)}%`;
                }
            };

            window.addEventListener('scroll', updateProgress);
            updateProgress();

            // Generate Table of Contents
            const tocContainer = document.getElementById('toc');
            if (tocContainer) {
                const headings = document.querySelectorAll('.prose h2, .prose h3');
                
                if (headings.length > 0) {
                    headings.forEach((heading, index) => {
                        // Add ID to heading if it doesn't have one
                        if (!heading.id) {
                            heading.id = `heading-${index}`;
                        }
                        
                        const level = heading.tagName === 'H2' ? 0 : 1;
                        const link = document.createElement('a');
                        link.href = `#${heading.id}`;
                        link.textContent = heading.textContent;
                        link.className = `block py-1 text-base-content/70 hover:text-primary transition-colors ${level === 1 ? 'pl-4 text-xs' : 'font-medium'}`;
                        
                        tocContainer.appendChild(link);
                    });

                    // Smooth scroll
                    tocContainer.querySelectorAll('a').forEach(link => {
                        link.addEventListener('click', (e) => {
                            e.preventDefault();
                            const target = document.querySelector(link.getAttribute('href'));
                            if (target) {
                                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                            }
                        });
                    });
                } else {
                    tocContainer.innerHTML = '<p class="text-sm text-base-content/50">No headings found</p>';
                }
            }

            // Copy link button
            const copyBtn = document.getElementById('copy-link-btn') as HTMLButtonElement | null;
            if (copyBtn) {
                const originalText = copyBtn.innerHTML;
                copyBtn.addEventListener('click', () => {
                    navigator.clipboard.writeText(window.location.href).then(() => {
                        copyBtn.innerHTML = '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg> Copied!';
                        setTimeout(() => {
                            copyBtn.innerHTML = originalText;
                        }, 2000);
                    });
                });
            }

            // Share buttons
            const shareTwitterBtn = document.getElementById('share-twitter');
            if (shareTwitterBtn) {
                shareTwitterBtn.addEventListener('click', () => {
                    const text = encodeURIComponent(document.title);
                    const url = encodeURIComponent(window.location.href);
                    window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`, '_blank', 'width=550,height=420');
                });
            }

            const shareLinkedinBtn = document.getElementById('share-linkedin');
            if (shareLinkedinBtn) {
                shareLinkedinBtn.addEventListener('click', () => {
                    const url = encodeURIComponent(window.location.href);
                    window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${url}`, '_blank', 'width=550,height=420');
                });
            }
        });
    </script>

    <!-- Newsletter Subscription Script -->
    <script>
        // Function to handle newsletter subscription
        async function handleNewsletterSubmit(formId: string, emailId: string, btnId: string, msgId: string) {
            const form = document.getElementById(formId);
            const emailInput = document.getElementById(emailId) as HTMLInputElement | null;
            const submitBtn = document.getElementById(btnId) as HTMLButtonElement | null;
            const messageDiv = document.getElementById(msgId);

            if (!form || !emailInput || !submitBtn || !messageDiv) return;

            form.addEventListener('submit', async (e) => {
                e.preventDefault();

                const email = emailInput.value.trim();
                if (!email) return;

                submitBtn.disabled = true;
                submitBtn.textContent = 'Subscribing...';
                messageDiv.classList.add('hidden');

                try {
                    const response = await fetch('http://localhost:8000/api/newsletter/subscribe/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ email }),
                    });

                    const data = await response.json();

                    if (response.ok && data.success) {
                        messageDiv.textContent = data.message || '✓ Successfully subscribed!';
                        messageDiv.className = 'text-xs mt-2 p-2 bg-success/20 text-success rounded';
                        messageDiv.classList.remove('hidden');
                        emailInput.value = '';
                    } else {
                        messageDiv.textContent = data.message || 'Failed to subscribe';
                        messageDiv.className = 'text-xs mt-2 p-2 bg-error/20 text-error rounded';
                        messageDiv.classList.remove('hidden');
                    }
                } catch (error) {
                    console.error('Newsletter subscription error:', error);
                    messageDiv.textContent = 'Network error. Please try again.';
                    messageDiv.className = 'text-xs mt-2 p-2 bg-error/20 text-error rounded';
                    messageDiv.classList.remove('hidden');
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Subscribe';
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Main newsletter form
            handleNewsletterSubmit('newsletter-form', 'newsletter-email', 'newsletter-btn', 'newsletter-message');

            // Sidebar newsletter form
            handleNewsletterSubmit('newsletter-form-sidebar', 'newsletter-email-sidebar', 'newsletter-btn-sidebar', 'newsletter-message-sidebar');
        });
    </script>
</Layout>
