---
import type { ProjectItem } from '@/data/projects';

interface Props {
  item: ProjectItem;
}

const { item } = Astro.props;

// Builder pattern: only include elements if data exists
const hasTitle = item.title && item.title.trim() !== '';
const hasOrganization = item.organization && item.organization.trim() !== '';
const hasRole = item.role && item.role.trim() !== '';
const hasType = item.type && item.type.trim() !== '';
const hasShortDescription = item.short_description && item.short_description.trim() !== '';
const hasDescription = item.description && item.description.trim() !== '';
const hasResponsibilities = item.responsibilities && item.responsibilities.length > 0;
const hasAchievements = item.achievements && item.achievements.length > 0;
const hasFeatures = item.features && item.features.length > 0;
const hasSkills = item.skills && item.skills.length > 0;
const hasTechStack = item.tech_stack && Object.keys(item.tech_stack).length > 0;
const hasDatasets = item.datasets && item.datasets.length > 0;
const hasAccuracy = item.accuracy && item.accuracy.trim() !== '';
const hasProjectUrl = item.project_url && item.project_url.trim() !== '';
const hasGithubUrl = item.github_url && item.github_url.trim() !== '';
const hasDemoUrl = item.demo_url && item.demo_url.trim() !== '';
const hasCollaboration = item.collaboration && item.collaboration.trim() !== '';
const hasTags = item.tags && item.tags.length > 0;
const hasStartDate = item.start_date && item.start_date.trim() !== '';
const hasEndDate = item.end_date && item.end_date.trim() !== '';

// Build date range
const dateRange = hasStartDate || hasEndDate
  ? `${hasStartDate ? item.start_date : 'N/A'} - ${hasEndDate ? item.end_date : 'N/A'}`
  : null;

// Get project type color
const getTypeColor = () => {
  if (!hasType) return 'badge-neutral';
  const type = item.type!.toLowerCase();
  if (type.includes('professional')) return 'badge-primary';
  if (type.includes('academic')) return 'badge-secondary';
  if (type.includes('personal')) return 'badge-accent';
  return 'badge-neutral';
};
---

<div class='project-card bg-base-100 rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 border border-base-300 overflow-hidden group'>
  <!-- Header Section -->
  <div class='bg-gradient-to-br from-primary/5 via-secondary/5 to-accent/5 p-6 border-b border-base-300'>
    <div class='flex flex-col sm:flex-row justify-between items-start gap-4'>
      <div class='flex-1'>
        {hasTitle && (
          <h3 class='text-2xl font-bold text-base-content mb-2 group-hover:text-primary transition-colors'>
            {item.title}
          </h3>
        )}

        <div class='flex flex-wrap gap-2 items-center mb-3'>
          {hasOrganization && (
            <span class='flex items-center gap-1 text-sm text-base-content/70'>
              <svg class='w-4 h-4' fill='currentColor' viewBox='0 0 20 20'>
                <path fill-rule='evenodd' d='M4 4a2 2 0 012-2h8a2 2 0 012 2v12a1 1 0 110 2h-3a1 1 0 01-1-1v-2a1 1 0 00-1-1H9a1 1 0 00-1 1v2a1 1 0 01-1 1H4a1 1 0 110-2V4zm3 1h2v2H7V5zm2 4H7v2h2V9zm2-4h2v2h-2V5zm2 4h-2v2h2V9z' clip-rule='evenodd'></path>
              </svg>
              {item.organization}
            </span>
          )}

          {hasRole && (
            <span class='flex items-center gap-1 text-sm text-base-content/70'>
              <svg class='w-4 h-4' fill='currentColor' viewBox='0 0 20 20'>
                <path fill-rule='evenodd' d='M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z' clip-rule='evenodd'></path>
              </svg>
              {item.role}
            </span>
          )}

          {dateRange && (
            <span class='flex items-center gap-1 text-sm text-base-content/60'>
              <svg class='w-4 h-4' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
                <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z'></path>
              </svg>
              {dateRange}
            </span>
          )}
        </div>

        {hasShortDescription && (
          <p class='text-base-content/80 leading-relaxed mb-3'>
            {item.short_description}
          </p>
        )}

        {hasDescription && !hasShortDescription && (
          <p class='text-base-content/80 leading-relaxed mb-3'>
            {item.description}
          </p>
        )}
      </div>

      <div class='flex flex-col gap-2'>
        {hasType && (
          <span class={`badge ${getTypeColor()} badge-lg`}>
            {item.type}
          </span>
        )}

        {hasAccuracy && (
          <div class='bg-success/10 text-success px-4 py-2 rounded-lg text-center'>
            <div class='text-lg font-bold'>{item.accuracy}</div>
            <div class='text-xs'>Accuracy</div>
          </div>
        )}

        {item.contributor_count && item.contributor_count > 0 && (
          <div class='flex items-center gap-1 text-sm text-base-content/70 bg-base-200 px-3 py-1 rounded-lg'>
            <svg class='w-4 h-4' fill='currentColor' viewBox='0 0 20 20'>
              <path d='M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z'></path>
            </svg>
            {item.contributor_count} {item.contributor_count === 1 ? 'Contributor' : 'Contributors'}
          </div>
        )}
      </div>
    </div>
  </div>

  <!-- Content Section -->
  <div class='p-6 space-y-5'>
    <!-- Collaboration -->
    {hasCollaboration && (
      <div class='bg-info/5 border border-info/20 rounded-lg p-3'>
        <p class='text-sm text-info flex items-start gap-2'>
          <svg class='w-5 h-5 flex-shrink-0 mt-0.5' fill='currentColor' viewBox='0 0 20 20'>
            <path d='M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z'></path>
          </svg>
          <span>{item.collaboration}</span>
        </p>
      </div>
    )}

    <!-- Responsibilities -->
    {hasResponsibilities && (
      <div>
        <h4 class='text-sm font-semibold text-base-content mb-2 flex items-center gap-2'>
          <svg class='w-4 h-4 text-primary' fill='currentColor' viewBox='0 0 20 20'>
            <path fill-rule='evenodd' d='M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z' clip-rule='evenodd'></path>
          </svg>
          Key Responsibilities
        </h4>
        <ul class='space-y-1.5'>
          {item.responsibilities!.map((resp) => (
            <li class='flex items-start gap-2 text-sm text-base-content/80'>
              <span class='text-primary mt-1 text-lg leading-none'>â€¢</span>
              <span>{resp}</span>
            </li>
          ))}
        </ul>
      </div>
    )}

    <!-- Features -->
    {hasFeatures && (
      <div>
        <h4 class='text-sm font-semibold text-base-content mb-2 flex items-center gap-2'>
          <svg class='w-4 h-4 text-secondary' fill='currentColor' viewBox='0 0 20 20'>
            <path d='M9 2a1 1 0 000 2h2a1 1 0 100-2H9z'></path>
            <path fill-rule='evenodd' d='M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm9.707 5.707a1 1 0 00-1.414-1.414L9 12.586l-1.293-1.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z' clip-rule='evenodd'></path>
          </svg>
          Features
        </h4>
        <ul class='grid grid-cols-1 sm:grid-cols-2 gap-2'>
          {item.features!.map((feature) => (
            <li class='flex items-start gap-2 text-sm text-base-content/80 bg-base-200 px-3 py-2 rounded-lg'>
              <svg class='w-4 h-4 text-secondary mt-0.5 flex-shrink-0' fill='currentColor' viewBox='0 0 20 20'>
                <path fill-rule='evenodd' d='M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z' clip-rule='evenodd'></path>
              </svg>
              <span>{feature}</span>
            </li>
          ))}
        </ul>
      </div>
    )}

    <!-- Achievements -->
    {hasAchievements && (
      <div>
        <h4 class='text-sm font-semibold text-base-content mb-2 flex items-center gap-2'>
          <svg class='w-4 h-4 text-success' fill='currentColor' viewBox='0 0 20 20'>
            <path d='M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z'></path>
          </svg>
          Achievements
        </h4>
        <ul class='space-y-1.5'>
          {item.achievements!.map((achievement) => (
            <li class='flex items-start gap-2 text-sm text-base-content/80'>
              <svg class='w-5 h-5 text-success mt-0.5 flex-shrink-0' fill='currentColor' viewBox='0 0 20 20'>
                <path fill-rule='evenodd' d='M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z' clip-rule='evenodd'></path>
              </svg>
              <span>{achievement}</span>
            </li>
          ))}
        </ul>
      </div>
    )}

    <!-- Datasets -->
    {hasDatasets && (
      <div>
        <h4 class='text-sm font-semibold text-base-content mb-2 flex items-center gap-2'>
          <svg class='w-4 h-4 text-warning' fill='currentColor' viewBox='0 0 20 20'>
            <path d='M3 12v3c0 1.657 3.134 3 7 3s7-1.343 7-3v-3c0 1.657-3.134 3-7 3s-7-1.343-7-3z'></path>
            <path d='M3 7v3c0 1.657 3.134 3 7 3s7-1.343 7-3V7c0 1.657-3.134 3-7 3S3 8.657 3 7z'></path>
            <path d='M17 5c0 1.657-3.134 3-7 3S3 6.657 3 5s3.134-3 7-3 7 1.343 7 3z'></path>
          </svg>
          Datasets
        </h4>
        <div class='flex flex-wrap gap-2'>
          {item.datasets!.map((dataset) => (
            <span class='px-3 py-1 bg-warning/10 text-warning text-xs font-medium rounded-lg border border-warning/20'>
              {dataset}
            </span>
          ))}
        </div>
      </div>
    )}

    <!-- Tech Stack -->
    {hasTechStack && (
      <div>
        <h4 class='text-sm font-semibold text-base-content mb-3 flex items-center gap-2'>
          <svg class='w-4 h-4 text-secondary' fill='currentColor' viewBox='0 0 20 20'>
            <path fill-rule='evenodd' d='M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633zM5.707 6.293a1 1 0 010 1.414L3.414 10l2.293 2.293a1 1 0 11-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0zm8.586 0a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 11-1.414-1.414L16.586 10l-2.293-2.293a1 1 0 010-1.414z' clip-rule='evenodd'></path>
          </svg>
          Tech Stack
        </h4>
        <div class='space-y-2'>
          {Object.entries(item.tech_stack!).map(([category, techs]) => (
            Array.isArray(techs) && techs.length > 0 ? (
              <div>
                <div class='text-xs text-base-content/60 uppercase font-semibold mb-1'>
                  {category.replace(/_/g, ' ')}
                </div>
                <div class='flex flex-wrap gap-1.5'>
                  {techs.map((tech) => (
                    <span class='px-2.5 py-1 bg-secondary/10 text-secondary text-xs font-medium rounded-md border border-secondary/20 hover:bg-secondary/20 transition-colors'>
                      {tech}
                    </span>
                  ))}
                </div>
              </div>
            ) : typeof techs === 'string' && techs.trim() !== '' ? (
              <div>
                <div class='text-xs text-base-content/60 uppercase font-semibold mb-1'>
                  {category.replace(/_/g, ' ')}
                </div>
                <span class='px-2.5 py-1 bg-secondary/10 text-secondary text-xs font-medium rounded-md border border-secondary/20 inline-block'>
                  {techs}
                </span>
              </div>
            ) : null
          ))}
        </div>
      </div>
    )}

    <!-- Skills -->
    {hasSkills && (
      <div>
        <h4 class='text-sm font-semibold text-base-content mb-2 flex items-center gap-2'>
          <svg class='w-4 h-4 text-accent' fill='currentColor' viewBox='0 0 20 20'>
            <path d='M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3zM3.31 9.397L5 10.12v4.102a8.969 8.969 0 00-1.05-.174 1 1 0 01-.89-.89 11.115 11.115 0 01.25-3.762zM9.3 16.573A9.026 9.026 0 007 14.935v-3.957l1.818.78a3 3 0 002.364 0l5.508-2.361a11.026 11.026 0 01.25 3.762 1 1 0 01-.89.89 8.968 8.968 0 00-5.35 2.524 1 1 0 01-1.4 0zM6 18a1 1 0 001-1v-2.065a8.935 8.935 0 00-2-.712V17a1 1 0 001 1z'></path>
          </svg>
          Skills Used
        </h4>
        <div class='flex flex-wrap gap-2'>
          {item.skills!.map((skill) => (
            <span class='px-3 py-1 bg-accent/10 text-accent text-xs font-medium rounded-full border border-accent/20 hover:bg-accent/20 transition-colors'>
              {skill}
            </span>
          ))}
        </div>
      </div>
    )}

    <!-- Tags -->
    {hasTags && (
      <div>
        <div class='flex flex-wrap gap-2'>
          {item.tags!.map((tag) => (
            <span class='px-3 py-1 bg-base-200 text-base-content/70 text-xs font-medium rounded-full hover:bg-base-300 transition-colors'>
              #{tag}
            </span>
          ))}
        </div>
      </div>
    )}
  </div>

  <!-- Footer with Links -->
  {(hasProjectUrl || hasGithubUrl || hasDemoUrl) && (
    <div class='bg-base-200 px-6 py-4 border-t border-base-300 flex flex-wrap gap-3'>
      {hasProjectUrl && (
        <a
          href={item.project_url}
          target='_blank'
          rel='noopener noreferrer'
          class='btn btn-sm btn-primary gap-2'
        >
          <svg class='w-4 h-4' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
            <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14'></path>
          </svg>
          Visit Project
        </a>
      )}

      {hasGithubUrl && (
        <a
          href={item.github_url}
          target='_blank'
          rel='noopener noreferrer'
          class='btn btn-sm btn-outline gap-2'
        >
          <svg class='w-4 h-4' fill='currentColor' viewBox='0 0 24 24'>
            <path d='M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z'></path>
          </svg>
          View Code
        </a>
      )}

      {hasDemoUrl && (
        <a
          href={item.demo_url}
          target='_blank'
          rel='noopener noreferrer'
          class='btn btn-sm btn-secondary gap-2'
        >
          <svg class='w-4 h-4' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
            <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z'></path>
            <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M21 12a9 9 0 11-18 0 9 9 0 0118 0z'></path>
          </svg>
          View Demo
        </a>
      )}
    </div>
  )}
</div>

<style>
  .project-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .project-card:hover {
    transform: translateY(-4px);
  }
</style>
