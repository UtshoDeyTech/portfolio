---
import { Image } from 'astro:assets';
import SocialIcons from './SocialIcons.astro';
import ProfilePictures from '@/assets/profile_pictures.jpg';

export interface Props {
    profile: any;
    template: any;
    social: any;
}

const { profile, template, social } = Astro.props;
const {fullName, title} = profile;
---
<aside
	id='navbar-aside'
	class='navbar-container px-6 py-8 h-screen w-[22rem] bg-gradient-to-b from-base-300 to-base-200 border-r border-base-300 text-base-content flex flex-col shadow-2xl overflow-visible'
	data-collapsed="false"
	transition:persist="navbar"
>
	<div class='flex flex-col justify-between h-full'>
		<!-- Collapse Toggle Button -->
		<div class='flex justify-end mb-4'>
			<button 
				id='collapse-toggle'
				class='btn btn-ghost btn-sm opacity-60 hover:opacity-100 transition-opacity'
				aria-label='Toggle sidebar'
			>
				<svg class='w-4 h-4 collapse-icon' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
					<path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M11 19l-7-7 7-7m8 14l-7-7 7-7'></path>
				</svg>
			</button>
		</div>

		<!-- Profile Section -->
		<div class='profile-section flex flex-col items-center text-center'>
			<div class='relative group profile-image-container'>
				<Image
					class='profile-image size-32 rounded-full object-cover shadow-lg ring-4 ring-base-100 transition-all duration-300 group-hover:scale-105'
					src={ProfilePictures}
					alt={`Profile picture of ${fullName}`}
				/>
				<div class='absolute inset-0 rounded-full bg-gradient-to-tr from-primary/20 to-secondary/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300'></div>
			</div>

			<div class='mt-6 space-y-2 profile-text'>
				<h1 class="text-2xl font-bold tracking-tight text-base-content">
					{fullName}
				</h1>
				<p class="text-lg font-medium text-primary">
					{title}
				</p>
				<div class='w-16 h-1 bg-gradient-to-r from-primary to-secondary rounded-full mx-auto'></div>
			</div>
		</div>

		<!-- Navigation Section -->
		<nav class='flex-1 mt-12'>
			<ul class='space-y-2'>
				<li>
					<a
						href={`${template.base}/`}
						class='group flex items-center px-4 py-3 text-base font-medium rounded-lg text-base-content hover:bg-primary/10 hover:text-primary transition-all duration-200 ease-in-out'
					>
						<svg class='w-5 h-5 mr-3 text-base-content/60 group-hover:text-primary transition-colors' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
							<path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6'></path>
						</svg>
						<span class='nav-text'>Home</span>
					</a>
				</li>
				<li>
					<a
						href={`${template.base}/education`}
						class='group flex items-center px-4 py-3 text-base font-medium rounded-lg text-base-content hover:bg-primary/10 hover:text-primary transition-all duration-200 ease-in-out'
					>
						<svg class='w-5 h-5 mr-3 text-base-content/60 group-hover:text-primary transition-colors' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
							<path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 14l9-5-9-5-9 5 9 5z'></path>
							<path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z'></path>
							<path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14zm-4 6v-7.5l4-2.222'></path>
						</svg>
						<span class='nav-text'>Education</span>
					</a>
				</li>
				<li>
					<a
						href={`${template.base}/experience`}
						class='group flex items-center px-4 py-3 text-base font-medium rounded-lg text-base-content hover:bg-primary/10 hover:text-primary transition-all duration-200 ease-in-out'
					>
						<svg class='w-5 h-5 mr-3 text-base-content/60 group-hover:text-primary transition-colors' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
							<path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z'></path>
						</svg>
						<span class='nav-text'>Experience</span>
					</a>
				</li>
				<li>
					<a
						href={`${template.base}/project`}
						class='group flex items-center px-4 py-3 text-base font-medium rounded-lg text-base-content hover:bg-primary/10 hover:text-primary transition-all duration-200 ease-in-out'
					>
						<svg class='w-5 h-5 mr-3 text-base-content/60 group-hover:text-primary transition-colors' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
							<path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10'></path>
						</svg>
						<span class='nav-text'>Project</span>
					</a>
				</li>
				<li>
					<a
						href={`${template.base}/research`}
						class='group flex items-center px-4 py-3 text-base font-medium rounded-lg text-base-content hover:bg-primary/10 hover:text-primary transition-all duration-200 ease-in-out'
					>
						<svg class='w-5 h-5 mr-3 text-base-content/60 group-hover:text-primary transition-colors' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
							<path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z'></path>
						</svg>
						<span class='nav-text'>Research</span>
					</a>
				</li>
				<li>
					<a
						href={`${template.base}/blog/1`}
						class='group flex items-center px-4 py-3 text-base font-medium rounded-lg text-base-content hover:bg-primary/10 hover:text-primary transition-all duration-200 ease-in-out'
					>
						<svg class='w-5 h-5 mr-3 text-base-content/60 group-hover:text-primary transition-colors' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
							<path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z'></path>
						</svg>
						<span class='nav-text'>Blog</span>
					</a>
				</li>
			</ul>
		</nav>

		<!-- Social Icons Section -->
		<div class='social-section mt-8 pt-6 border-t border-base-300'>
			<div class='flex justify-center'>
				<SocialIcons social={social}/>
			</div>
		</div>
	</div>
</aside>

<style>
	/* Base styles */
	.navbar-container {
		transition: width 0.3s ease-in-out;
		overflow-x: hidden;
	}

	/* Collapsed state styles */
	.navbar-container[data-collapsed="true"] {
		width: 5rem !important;
		padding-left: 0.5rem !important;
		padding-right: 0.5rem !important;
	}

	/* Show small profile icon when collapsed */
	.navbar-container[data-collapsed="true"] .profile-section {
		margin-top: 0.5rem;
		margin-bottom: 0.5rem;
	}

	.navbar-container[data-collapsed="true"] .profile-image {
		width: 2.5rem !important;
		height: 2.5rem !important;
		ring-width: 2px !important;
	}

	/* Hide profile text when collapsed */
	.navbar-container[data-collapsed="true"] .profile-text {
		display: none !important;
	}

	/* Hide text labels when collapsed */
	.navbar-container[data-collapsed="true"] .nav-text {
		display: none !important;
	}

	/* Hide social section when collapsed */
	.navbar-container[data-collapsed="true"] .social-section {
		display: none !important;
	}

	/* Adjust nav spacing when collapsed */
	.navbar-container[data-collapsed="true"] nav {
		margin-top: 1rem !important;
		flex: 1;
	}

	/* Center and style navigation links when collapsed */
	.navbar-container[data-collapsed="true"] nav ul {
		display: flex;
		flex-direction: column;
		gap: 0.5rem;
	}

	.navbar-container[data-collapsed="true"] nav li {
		width: 100%;
	}

	.navbar-container[data-collapsed="true"] nav a {
		display: flex !important;
		justify-content: center !important;
		align-items: center !important;
		padding: 0.75rem !important;
		margin: 0 !important;
		width: 100%;
	}

	/* Icon styling when collapsed */
	.navbar-container[data-collapsed="true"] nav svg {
		margin: 0 !important;
		width: 1.5rem !important;
		height: 1.5rem !important;
		flex-shrink: 0;
	}

	/* Rotate collapse icon */
	.navbar-container[data-collapsed="true"] .collapse-icon {
		transform: rotate(180deg);
	}

	/* Smooth transitions */
	.navbar-container .profile-section {
		transition: all 0.3s ease-in-out;
	}

	.navbar-container .profile-image {
		transition: all 0.3s ease-in-out;
	}

	.navbar-container .profile-text,
	.navbar-container .nav-text,
	.navbar-container .social-section {
		transition: opacity 0.2s ease-in-out;
	}

	.navbar-container .collapse-icon {
		transition: transform 0.3s ease-in-out;
	}

	nav a {
		transition: all 0.3s ease-in-out;
	}

	nav svg {
		transition: all 0.3s ease-in-out;
	}
</style>

<script is:inline>
	// Apply saved state immediately - works for initial page load
	(function() {
		try {
			const savedState = localStorage.getItem('navbar-collapsed');

			function applyState() {
				const navbar = document.getElementById('navbar-aside') || document.querySelector('.navbar-container');
				if (navbar) {
					if (savedState === 'true') {
						navbar.setAttribute('data-collapsed', 'true');
					} else {
						navbar.setAttribute('data-collapsed', 'false');
					}
				}
			}

			if (document.readyState === 'loading') {
				document.addEventListener('DOMContentLoaded', applyState);
			} else {
				applyState();
			}
		} catch (e) {
			console.error('Navbar: Error loading state:', e);
		}
	})();
</script>

<script>
	// Handle toggle button clicks - supports View Transitions
	function initNavbarToggle() {
		const collapseToggle = document.getElementById('collapse-toggle');
		const navbarContainer = document.getElementById('navbar-aside') || document.querySelector('.navbar-container');

		if (collapseToggle && navbarContainer) {
			// Always load and apply saved state on every page load
			const savedState = localStorage.getItem('navbar-collapsed');
			if (savedState === 'true') {
				navbarContainer.setAttribute('data-collapsed', 'true');
			} else {
				navbarContainer.setAttribute('data-collapsed', 'false');
			}

			// Remove old event listeners to prevent duplicates
			const newToggle = collapseToggle.cloneNode(true);
			collapseToggle.parentNode.replaceChild(newToggle, collapseToggle);

			// Add toggle handler to new button
			newToggle.addEventListener('click', function() {
				const isCollapsed = navbarContainer.getAttribute('data-collapsed') === 'true';
				const newState = (!isCollapsed).toString();
				navbarContainer.setAttribute('data-collapsed', newState);
				localStorage.setItem('navbar-collapsed', newState);
			});
		}
	}

	// Initialize on both initial load and View Transitions navigation
	document.addEventListener('DOMContentLoaded', initNavbarToggle);
	document.addEventListener('astro:page-load', initNavbarToggle);
	document.addEventListener('astro:after-swap', initNavbarToggle);
</script>